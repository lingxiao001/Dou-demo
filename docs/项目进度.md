# 项目进度（基于提交记录）

- 更新时间：2025-11-27
- 数据来源：`git log` 提交记录（不含合并提交）

## 概览
- 架构：完成核心 MVVM 改造，全面引入并应用 `flutter_riverpod`（Riverpod 2.0），建立通用 Provider 与 ViewModel 层。
- 页面与交互：视频播放页（左右 Tab 联动、拍同款“音乐轮盘”）、“我的”页面与头像更换、评论组件与数据、单击暂停/双击点赞交互优化。
- AI 能力：接入多模态豆包 API（支持“截取当前画面提问”），新增 AI 悬浮球（当前 API 稳定性待提升）。
- 数据与性能：新增 `ThumbnailCacheService`，显著优化滑动过程中的缩略图加载与缓存。
- 未完项：直播与团购尚未实现（现用 mock 数据占位），部分 Web 路径问题待修复，AI 接口需替换为更稳定来源。

## 时间线与里程碑

### 2025-11-23
- 9c5ab88 成功重构 viewer：MVVM 化；新增 `ViewerPostsViewModel` 与 `ViewerIndexViewModel`；`ViewerScreen` 改为 `ConsumerStatefulWidget`；移除 `FutureBuilder`，改为 Provider 订阅。
- 1b1305a 使用 Riverpod 2.0 新写法，简化 feed ViewModel。
- 723971c 初步 MVVM 改造：引入 `flutter_riverpod`；建立通用 Provider（`videoRepositoryProvider`、`userPrefsServiceProvider`、`llmApiProvider`、`aiChatServiceProvider`）；落地 Feed 外流的 ViewModel；`FeedGridScreen` 改为 `ConsumerStatefulWidget` 并在 `initState` 调用 `vm.load()`。
- dc0f55f 增加计划书；开始完善 ViewModel 层；阶段性重构。

### 2025-11-21
- d1c69f7 TikTok 视频页：接入多模态豆包 API，支持“截取当前画面提问”。

### 2025-11-20
- bfad787 新增 AI 悬浮球；当前调用不稳定，建议更换为更稳定的 API 来源。
- b742255 直播、团购未实现；加入 mock 数据以占位与美化。
- 86eba95 修复 Web 端 page 左右滑动 Tab 联动切换问题。
- e454005 增加“我的”界面与更换头像功能。
- ada105d 增加评论 mock 数据。
- 243f1ec 新增评论组件与功能。
- c756032 增加“音乐轮盘”（拍同款）。
- 25ad188 交互修复：单击暂停 / 双击点赞；`onTap` 负责播放/暂停、`onDoubleTap` 负责点赞；优化双击窗口内触发顺序。

### 2025-11-19
- 9ed6a4f 新增 `ThumbnailCacheService`，修复手机端视频预览图加载；Web 端路径问题待修复；提升滑动过程中的缩略图加载性能。

## 当前状态
- 架构改造：
  - Viewer 与 Feed 的核心流已完成 MVVM 化（见 9c5ab88、723971c、1b1305a）。
  - 通用 Provider 与服务层已落地（`app_providers.dart`、`video_repository.dart`、`user_prefs_service.dart`、`ai_chat_service.dart`）。
- 功能完备度：
  - 视频页：播放、左右 Tab 联动、拍同款“音乐轮盘”、评论组件与数据已具备（见 c756032、ada105d、243f1ec、86eba95）。
  - AI 能力：多模态问答已接入；AI 悬浮球存在稳定性问题（见 d1c69f7、bfad787）。
  - 个人中心：“我的”页面与头像更换完成（见 e454005）。
- 未实现 / 风险项：
  - 直播、团购暂未实现（见 b742255），仍为 mock。
  - Web 路径问题待修复（见 9ed6a4f 注记）。
  - AI 接口需替换为更稳定来源（见 bfad787）。

## 相关代码定位
- 视频页视图与交互：`lib/features/viewer/views/tiktok_video_page.dart`
- 视频页容器：`lib/features/viewer/views/viewer_screen.dart`
- Viewer ViewModel：`lib/features/viewer/viewmodels/viewer_view_model.dart`
- Feed 视图与 ViewModel：`lib/features/feed/views/feed_grid_screen.dart`、`lib/features/feed/viewmodels/feed_grid_view_model.dart`
- AI 悬浮球与聊天：`lib/features/ai/widgets/ai_fab.dart`、`lib/common/services/ai_chat_service.dart`
- Provider 聚合：`lib/common/providers/app_providers.dart`
- 缩略图缓存：`lib/common/services/thumbnail_cache_service.dart`

## 后续建议（基于提交内容）
- 替换或封装更稳定的 AI 接口，统一失败重试与超时策略。
- 落地直播与团购的真实数据与交互，替换 mock；定义 ViewModel 与仓库接口。
- 修复并回归 Web 端资源路径问题；为移动与 Web 统一抽象资源定位器。
- 为关键交互补充测试（单击/双击、Tab 联动、缩略图缓存命中）。

> 说明：以上仅基于提交记录进行归纳与整理，若有遗漏或需细化，请补充具体提交或需求点。
